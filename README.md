## AI-Based Generation of Synthetic Contrast-Enhanced Mammography Images

We develop an AI-based synthetic contrast-enhanced mammography image generation system, RISS, that can generate recombined images based on low-energy images and successfully apply it to mammography. RISS was trained and evaluation in a large-scale cohort of over one hundred thousand images form six hospitals in China and two international public cohorts. Comprehensive quantitative and qualitative evaluations have demonstrated the quality and clinical value of the synthesized recombined images generated by RISS. Importantly, when extended to mammography, RISS eliminated the need for contrast agents and the associated 20â€“30 minutes of preparation, injection, and observation. This capability significantly enhanced diagnostic sensitivity, reducing the risk of missed diagnoses, and reduced unnecessary biopsies compared to mammography alone.


## Installation
First clone the repo and cd into the directory:

```bash
git clone https://github.com/yyyhd/RISS
cd RISS
```
Create a new enviroment with anaconda.

## Dependencies
```
python>=3.6.13
torch>=1.10.1
torchvision>=0.8.2
visdom
dominate
scikit-image
h5py
scipy
ml_collections
CUDA >= 11.2
```

### ðŸ”— Download Model Weights

You can download the trained weights from Hugging Face:
```
[https://huggingface.co/baguai/RISS1/resolve/main/latest_net_G.pth](https://huggingface.co/baguai/RISS1/resolve/main/latest_net_G.pth)
```
### ðŸ”§ Model Weights Usage

Please place the downloaded model weights file (e.g., `latest_net_G.pth`) in the following directory:
```
/Checkpoints/le_re/ 
â”œâ”€â”€ latest_net_G.pth
```

## Dataset
Before the CEM images were input into the RISS, an algorithm based on automatic threshold segmentation (Otsu) was implemented to isolate the mammary gland from the background. Following the cropping of the breast area, the images were standardized to a resolution of 512Ã—1024 pixels and normalized. To create a two-dimensional image suitable for input into the generator network, the low-energy image and recombined image for each view, along with all-zero images (CC and MLO views), were assigned to the red, green, and blue channels of the RGB image, respectively. During the subsequent network training process, the network was guided to generate a recombined image for the green channel based on the low-energy image in the red channel.
```
/Datasets/
  â”œâ”€â”€ train
  â”œâ”€â”€ val
  â”œâ”€â”€ test  
```

## Basic Usage: Generate recombind images from low-energy images:
```
python3 test.py --dataroot Datasets/IXI/dataset/le_re/ --name le_re --gpu_ids 0 --model resvit_one --which_model_netG resvit --dataset_mode aligned --norm batch --phase test --output_nc 1 --input_nc 1 --how_many 10000 --serial_batches --fineSize 256 --loadSize 256  --results_dir /IXI/result --checkpoints_dir /IXI/Checkpoints --which_epoch latest
```
## Basic Usage: Generate recombind images from mammography images:
```
python3 test.py --dataroot Datasets/IXI/dataset/mammography_re/ --name le_re --gpu_ids 0 --model resvit_one --which_model_netG resvit --dataset_mode aligned --norm batch --phase test --output_nc 1 --input_nc 1 --how_many 10000 --serial_batches --fineSize 256 --loadSize 256  --results_dir /IXI/result --checkpoints_dir /IXI/Checkpoints --which_epoch latest
```

Acknowledgements
The project was built on many amazing open-source repositories: Quilt1M, PathAsst, torchscale, accelerate (model pretraining), deepspeed (model pretraining), pytorch-lightning (downstream finetuning), CLIP Benchmark (model evaluation), and PORPOISE (prognosis). We thank the authors and developers for their contributions.

Issues
Please open new threads or address questions to xiangjx@stanford.edu or xiyue.wang.scu@gmail.com
License
This model and associated code are released under the CC-BY-NC-ND 4.0 license and may only be used for non-commercial, academic research purposes with proper attribution. Any commercial use, sale, or other monetization of the MUSK model and its derivatives, which include models trained on outputs from the MUSK model or datasets created from the MUSK model, is prohibited and requires prior approval.
